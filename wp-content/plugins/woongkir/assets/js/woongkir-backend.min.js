!function(l,t){"use strict";var n,i,c,a;Array.prototype.find||Object.defineProperty(Array.prototype,"find",{value:function(e){if(null==this)throw TypeError('"this" is null or not defined');var o=Object(this),t=o.length>>>0;if("function"!=typeof e)throw TypeError("predicate must be a function");for(var r=arguments[1],n=0;n<t;){var i=o[n];if(e.call(r,i,n,o))return i;n++}},configurable:!0,writable:!0}),Array.prototype.filter||(Array.prototype.filter=function(e,o){if("Function"!=typeof e&&"function"!=typeof e||!this)throw new TypeError;var t,r=this.length>>>0,n=new Array(r),i=this,c=0,a=-1;if(void 0===o)for(;++a!=r;)a in this&&(t=i[a],e(i[a],a,i)&&(n[c++]=t));else for(;++a!=r;)a in this&&(t=i[a],e.call(o,i[a],a,i)&&(n[c++]=t));return n.length=c,n}),Array.prototype.every||(Array.prototype.every=function(e,o){var t,r;if(null==this)throw new TypeError("this is null or not defined");var n=Object(this),i=n.length>>>0;if("function"!=typeof e&&"[object Function]"!==Object.prototype.toString.call(e))throw new TypeError;for(1<arguments.length&&(t=o),r=0;r<i;){if(r in n){var c=n[r],c=t?e.call(t,c,r,n):e(c,r,n);if(!c)return!1}r++}return!0}),Array.prototype.map||(Array.prototype.map=function(e){var o,t,r;if(null==this)throw new TypeError("this is null or not defined");var n,i=Object(this),c=i.length>>>0;if("function"!=typeof e)throw new TypeError(e+" is not a function");for(1<arguments.length&&(o=arguments[1]),t=new Array(c),r=0;r<c;)r in i&&(n=i[r],n=e.call(o,n,r,i),t[r]=n),r++;return t}),Array.prototype.forEach||(Array.prototype.forEach=function(e,o){if(null==this)throw new TypeError("Array.prototype.forEach called on null or undefined");var t,r,n,i=Object(this),c=i.length>>>0;if("function"!=typeof e)throw new TypeError(e+" is not a function");for(1<arguments.length&&(t=o),r=0;r<c;)r in i&&(n=i[r],e.call(t,n,r,i)),r++}),Object.keys||(Object.keys=(n=Object.prototype.hasOwnProperty,i=!{toString:null}.propertyIsEnumerable("toString"),a=(c=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"]).length,function(e){if("function"!=typeof e&&("object"!=typeof e||null===e))throw new TypeError("Object.keys called on non-object");var o,t,r=[];for(o in e)n.call(e,o)&&r.push(o);if(i)for(t=0;t<a;t++)n.call(e,c[t])&&r.push(c[t]);return r}));var e,d={updateCheckoutTimeoutId:null,renderLocationFields:function(i,c){var a=new l.Deferred,s=0;return l.each(d.getFields(),function(t,r){var n;!c||-1===c.indexOf(t)||l("#"+(n=i+"_"+t))&&l("#"+n).length&&d.getLocationData(t).then(function(e){var o=d.filterLocationData(e,i,t,r),e=o.find(function(e){return e.selected}),e=e?e.id:null;l("#"+n).selectWoo({data:o,width:"100%"}).val(e),++s===c.length&&a.resolve()})}),a.promise()},onChangeFieldState:function(e){var o=l(e.target).attr("id").replace("_state","");d.renderLocationFields(o,["city","address_2"]).then(function(){l("#"+o+"_city").trigger("change")})},onChangeFieldCity:function(e){var o=l(e.target).attr("id").replace("_city","");d.renderLocationFields(o,["address_2"]).then(function(){l("#"+o+"_address_2").trigger("change")})},onChangeFieldAddress2:function(e){var o=l(e.target).attr("id").replace("_address_2",""),e=l("#ship-to-different-address-checkbox").is(":checked");t&&t.is_checkout&&(e&&"billing"===o||(d.updateCheckoutTimeoutId&&clearTimeout(d.updateCheckoutTimeoutId),d.updateCheckoutTimeoutId=setTimeout(function(){l(document.body).trigger("update_checkout")},200)))},getFields:function(){return{state:{onChange:d.onChangeFieldState,convert:!1,restore:!1},city:{onChange:d.onChangeFieldCity,convert:!0,restore:!0,fieldFilters:["state"]},address_2:{onChange:d.onChangeFieldAddress2,convert:!0,restore:!0,fieldFilters:["state","city"]}}},getLocationDataCountry:function(){return d.getLocationData("country")},getLocationDataState:function(){return d.getLocationData("state")},getLocationDataCity:function(){return d.getLocationData("city")},getLocationDataAddress2:function(){return d.getLocationData("address_2")},getLocationData:function(e){var o=new l.Deferred,t=woongkir_params.json[e].key,r=woongkir_params.json[e].url,n=Lockr.get(t);return null==n?(e=Math.random().toString(36).substring(7),l.getJSON(r,{[e]:(new Date).getTime()},function(e){e.sort(function(e,o){return e.value>o.value?1:o.value>e.value?-1:0}),Lockr.set(t,e),o.resolve(e)})):o.resolve(n),o.promise()},filterLocationData:function(e,o,t,r){var n=[];return r.fieldFilters&&(n=r.fieldFilters.filter(function(e){return 0<l("#"+o+"_"+e).length}).map(function(e){return{key:e,value:l("#"+o+"_"+e).val()}})),e.filter(function(o){return!n||!n.length||n.every(function(e){return o[e.key]===e.value})}).map(function(e){return{id:e.value,text:e.label||e.value,selected:l("#"+o+"_"+t).val()===e.value}})}};function r(e){var r,o,t=l(e.target);t.is(":checked")&&(o=t.data("accounts"),(e=(r=t.val())&&o[r])&&(o=l("#woocommerce_woongkir_volumetric_calculator"),e.volumetric?(o.closest("tr").length?o.closest("tr"):l("label[for='woocommerce_woongkir_volumetric_calculator']").show().next("fieldset")).show():(o.prop("checked",!1),(o.closest("tr").length?o.closest("tr"):l("label[for='woocommerce_woongkir_volumetric_calculator']").hide().next("fieldset")).hide()),o.trigger("change"),t=t.data("couriers"),l.each(t,function(e,o){var t=[];l.each(o,function(e,o){o.account&&-1!==o.account.indexOf(r)&&t.push(e)}),l("#woongkir-couriers-"+e).find(".woongkir-couriers-item").each(function(){t.length&&-1!==t.indexOf(l(this).data("id"))?l(this).show():l(this).hide().find(".woongkir-service--bulk").prop("checked",!1).trigger("change")})}),e.multiple_couriers||l.each(t,function(e){var o=l("#woongkir-couriers-"+e).find(".woongkir-service--single:checked").first();o&&o.length&&((o=o.closest(".woongkir-couriers-item").find(".woongkir-service--bulk"))&&o.length&&l("#woongkir-couriers-"+e).find(".woongkir-service--bulk").not(o).prop("checked",!1).trigger("change"))})))}function s(e){var o=l("#woocommerce_woongkir_volumetric_divider");l(e.target).is(":checked")?(o.closest("tr").length?o.closest("tr"):l("label[for='woocommerce_woongkir_volumetric_divider']").show().next("fieldset")).show():(o.closest("tr").length?o.closest("tr"):l("label[for='woocommerce_woongkir_volumetric_divider']").hide().next("fieldset")).hide()}function g(e){e.preventDefault(),l(e.currentTarget).find(".dashicons").toggleClass("dashicons-admin-generic dashicons-arrow-up-alt2").closest(".woongkir-couriers-item").toggleClass("expanded")}function u(e){var o=l(e.target),t=o.closest(".woongkir-couriers"),r=o.closest(".woongkir-couriers-item"),n=l(".woongkir-account-type:checked"),e=n.data("accounts"),n=n.val(),n=n&&e[n],o=o.is(":checked");r.find(".woongkir-service--single").prop("checked",o).trigger("change"),o&&!n.multiple_couriers&&t.find(".woongkir-couriers-item").not(r).each(function(){l(this).find(".woongkir-service--bulk:checked").prop("checked",!1).trigger("change"),l(this).find(".woongkir-service--single:checked").prop("checked",!1).trigger("change")})}function h(e){var o=l(e.target),t=o.closest(".woongkir-couriers"),r=o.closest(".woongkir-couriers-item"),n=l(".woongkir-account-type:checked"),i=n.data("accounts"),e=n.val(),n=e&&i[e],i=r.find(".woongkir-service--single:checked").length,e=r.find(".woongkir-service--single").length;r.find(".woongkir-couriers--selected").text(i),r.find(".woongkir-couriers--available").text(e);e=0<i,i=e?".woongkir-service--bulk:not(:checked)":".woongkir-service--bulk:checked";r.find(i).prop("checked",e),o.is(":checked")&&!n.multiple_couriers&&t.find(".woongkir-couriers-item").not(r).each(function(){l(this).find(".woongkir-service--single:checked").prop("checked",!1).trigger("change")})}function f(e){e.preventDefault();var o=l(e.target),t=o.attr("href"),e=l(t);e&&e.length&&(l(".woongkir-tab-nav-item").each(function(){l(this).is(o)?l(this).addClass("active"):l(this).removeClass("active")}),l(".woongkir-tab-content").each(function(){l(this).is(t)?l(this).addClass("active"):l(this).removeClass("active")}))}l(document.body).on("wc_backbone_modal_loaded",function(e,o){var i,c;!e||"wc-modal-shipping-method-settings"!==o||l("."+o).find('[name^="woocommerce_woongkir_"]').length<1||(l("."+o).addClass("wc-modal-shipping-method-settings--woongkir"),i="woocommerce_woongkir_origin_location",c=l.extend(!0,{},woongkir_params.locale.default,woongkir_params.locale.ID),l.each(d.getFields(),function(t,r){var n=l("#"+i+"_"+t);n&&n.length&&(n.off("change",r.onChange),d.getLocationData(t).then(function(e){var o=d.filterLocationData(e,i,t,r),e=c[t]&&c[t].placeholder||"";n.attr({placeholder:e}).data({placeholder:e}).selectWoo({data:o,width:"100%"}),n.on("change",r.onChange)}))}),l(".woongkir-couriers").sortable({axis:"y",cursor:"move"}),l("#woocommerce_woongkir_api_key_toggle").remove(),l("#woocommerce_woongkir_api_key").each(function(){l(this).after('<button id="woocommerce_woongkir_api_key_toggle" type="button" class="button button-secondary woongkir-api-key-view"><span class="dashicons dashicons-visibility" style="margin-top: 4px;"></span></button>')}),l("#woocommerce_woongkir_api_key_toggle").off("click"),l("#woocommerce_woongkir_api_key_toggle").on("click",function(e){e.preventDefault(),"password"===l("#woocommerce_woongkir_api_key").attr("type")?l("#woocommerce_woongkir_api_key").attr("type","text"):l("#woocommerce_woongkir_api_key").attr("type","password"),l(this).find("span").toggleClass("dashicons-visibility dashicons-hidden")}),l(document.body).off("change",".woongkir-account-type",r),l(document.body).on("change",".woongkir-account-type",r),l(document.body).find(".woongkir-account-type").trigger("change"),l(document.body).off("change","#woocommerce_woongkir_volumetric_calculator",s),l(document.body).on("change","#woocommerce_woongkir_volumetric_calculator",s),l(document.body).find("#woocommerce_woongkir_volumetric_calculator").trigger("change"),l(document.body).off("click",".woongkir-couriers-toggle",g),l(document.body).on("click",".woongkir-couriers-toggle",g),l(document.body).off("change",".woongkir-service--bulk",u),l(document.body).on("change",".woongkir-service--bulk",u),l(document.body).off("change",".woongkir-service--single",h),l(document.body).on("change",".woongkir-service--single",h),l(document.body).off("click",".woongkir-tab-nav-item",f),l(document.body).on("click",".woongkir-tab-nav-item",f),l(document.body).find(".woongkir-tab-nav-item").first().trigger("click"))}),l(document).ready(function(){!function(e){var o={},t=document.createElement("a");t.href=e;for(var r=t.search.substring(1).split("&"),n=0;n<r.length;n++){var i=r[n].split("=");2===i.length&&(o[i[0]]=decodeURIComponent(i[1]))}return o}(window.location.search).woongkir_settings||(e&&clearTimeout(e),e=setTimeout(function(){var e=l(document).find(".wc-shipping-zone-method-type").filter(function(){return l(this).text()===woongkir_params.method_title});e.length?l(e).closest("tr").find(".row-actions .wc-shipping-zone-method-settings").trigger("click"):(l(".wc-shipping-zone-add-method").trigger("click"),l('select[name="add_method_id"]').val(woongkir_params.method_id).trigger("change"))},500))})}(jQuery,window.wc_checkout_params);