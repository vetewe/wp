!function(u,r){"use strict";var o,a,i,c;Array.prototype.find||Object.defineProperty(Array.prototype,"find",{value:function(e){if(null==this)throw TypeError('"this" is null or not defined');var t=Object(this),r=t.length>>>0;if("function"!=typeof e)throw TypeError("predicate must be a function");for(var n=arguments[1],o=0;o<r;){var a=t[o];if(e.call(n,a,o,t))return a;o++}},configurable:!0,writable:!0}),Array.prototype.filter||(Array.prototype.filter=function(e,t){if("Function"!=typeof e&&"function"!=typeof e||!this)throw new TypeError;var r,n=this.length>>>0,o=new Array(n),a=this,i=0,c=-1;if(void 0===t)for(;++c!=n;)c in this&&(r=a[c],e(a[c],c,a)&&(o[i++]=r));else for(;++c!=n;)c in this&&(r=a[c],e.call(t,a[c],c,a)&&(o[i++]=r));return o.length=i,o}),Array.prototype.every||(Array.prototype.every=function(e,t){var r,n;if(null==this)throw new TypeError("this is null or not defined");var o=Object(this),a=o.length>>>0;if("function"!=typeof e&&"[object Function]"!==Object.prototype.toString.call(e))throw new TypeError;for(1<arguments.length&&(r=t),n=0;n<a;){if(n in o){var i=o[n],i=r?e.call(r,i,n,o):e(i,n,o);if(!i)return!1}n++}return!0}),Array.prototype.map||(Array.prototype.map=function(e){var t,r,n;if(null==this)throw new TypeError("this is null or not defined");var o,a=Object(this),i=a.length>>>0;if("function"!=typeof e)throw new TypeError(e+" is not a function");for(1<arguments.length&&(t=arguments[1]),r=new Array(i),n=0;n<i;)n in a&&(o=a[n],o=e.call(t,o,n,a),r[n]=o),n++;return r}),Array.prototype.forEach||(Array.prototype.forEach=function(e,t){if(null==this)throw new TypeError("Array.prototype.forEach called on null or undefined");var r,n,o,a=Object(this),i=a.length>>>0;if("function"!=typeof e)throw new TypeError(e+" is not a function");for(1<arguments.length&&(r=t),n=0;n<i;)n in a&&(o=a[n],e.call(r,o,n,a)),n++}),Object.keys||(Object.keys=(o=Object.prototype.hasOwnProperty,a=!{toString:null}.propertyIsEnumerable("toString"),c=(i=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"]).length,function(e){if("function"!=typeof e&&("object"!=typeof e||null===e))throw new TypeError("Object.keys called on non-object");var t,r,n=[];for(t in e)o.call(e,t)&&n.push(t);if(a)for(r=0;r<c;r++)o.call(e,i[r])&&n.push(i[r]);return n}));var s={updateCheckoutTimeoutId:null,renderLocationFields:function(a,i){var c=new u.Deferred,l=0;return u.each(s.getFields(),function(r,n){var o;!i||-1===i.indexOf(r)||u("#"+(o=a+"_"+r))&&u("#"+o).length&&s.getLocationData(r).then(function(e){var t=s.filterLocationData(e,a,r,n),e=t.find(function(e){return e.selected}),e=e?e.id:null;u("#"+o).selectWoo({data:t,width:"100%"}).val(e),++l===i.length&&c.resolve()})}),c.promise()},onChangeFieldState:function(e){var t=u(e.target).attr("id").replace("_state","");s.renderLocationFields(t,["city","address_2"]).then(function(){u("#"+t+"_city").trigger("change")})},onChangeFieldCity:function(e){var t=u(e.target).attr("id").replace("_city","");s.renderLocationFields(t,["address_2"]).then(function(){u("#"+t+"_address_2").trigger("change")})},onChangeFieldAddress2:function(e){var t=u(e.target).attr("id").replace("_address_2",""),e=u("#ship-to-different-address-checkbox").is(":checked");r&&r.is_checkout&&(e&&"billing"===t||(s.updateCheckoutTimeoutId&&clearTimeout(s.updateCheckoutTimeoutId),s.updateCheckoutTimeoutId=setTimeout(function(){u(document.body).trigger("update_checkout")},200)))},getFields:function(){return{state:{onChange:s.onChangeFieldState,convert:!1,restore:!1},city:{onChange:s.onChangeFieldCity,convert:!0,restore:!0,fieldFilters:["state"]},address_2:{onChange:s.onChangeFieldAddress2,convert:!0,restore:!0,fieldFilters:["state","city"]}}},getLocationDataCountry:function(){return s.getLocationData("country")},getLocationDataState:function(){return s.getLocationData("state")},getLocationDataCity:function(){return s.getLocationData("city")},getLocationDataAddress2:function(){return s.getLocationData("address_2")},getLocationData:function(e){var t=new u.Deferred,r=woongkir_params.json[e].key,n=woongkir_params.json[e].url,o=Lockr.get(r);return null==o?(e=Math.random().toString(36).substring(7),u.getJSON(n,{[e]:(new Date).getTime()},function(e){e.sort(function(e,t){return e.value>t.value?1:t.value>e.value?-1:0}),Lockr.set(r,e),t.resolve(e)})):t.resolve(o),t.promise()},filterLocationData:function(e,t,r,n){var o=[];return n.fieldFilters&&(o=n.fieldFilters.filter(function(e){return 0<u("#"+t+"_"+e).length}).map(function(e){return{key:e,value:u("#"+t+"_"+e).val()}})),e.filter(function(t){return!o||!o.length||o.every(function(e){return t[e.key]===e.value})}).map(function(e){return{id:e.value,text:e.label||e.value,selected:u("#"+t+"_"+r).val()===e.value}})}},d={};u(document.body).on("country_to_state_changed",function(e,t,r){var n,l;"country_to_state_changed"===e.type&&(n=t||u("#calc_shipping_country").val(),(r=r&&r.prevObject?r.prevObject:u("#calc_shipping_country"))&&r.length&&(l=r.attr("ID").replace("_country",""),d[l]&&clearTimeout(d[l]),d[l]=setTimeout(function(){var o,e,a,i,c;"ID"===n?(i=l,c=u.extend(!0,{},woongkir_params.locale.default,woongkir_params.locale.ID),u.each(s.getFields(),function(t,r){var e,n=i+"_"+t,o=c[t]||{};u("#"+n).length<1&&"calc_shipping"===i&&"address_2"===t&&((e=u("#"+i+"_postcode_field"))&&e.length&&(e.clone().attr({id:n+"_field"}).insertBefore(e),e=c[t]&&c[t].placeholder||"",u("#"+n+"_field").find("input").attr({id:n,name:n,placeholder:e,"data-placeholder":e,value:u("#woongkir_"+i+"_"+t).val()}))),u("#"+n).length<1||("address_2"===t&&o.label&&u('label[for="'+n+'"]').removeClass("screen-reader-text"),r.onChange&&u("#"+n).off("change",r.onChange),o=!0===r.convert||Array.isArray(r.convert)&&-1!==r.convert.indexOf(i),!u("#"+n).data("select2")&&o?s.getLocationData(t).then(function(e){e=s.filterLocationData(e,i,t,r);u("#"+n).selectWoo({data:e,width:"100%"}),r.onChange&&u("#"+n).on("change",r.onChange)}):r.onChange&&u("#"+n).on("change",r.onChange))})):(o=l,e=n,a=u.extend(!0,{},woongkir_params.locale.default,woongkir_params.locale[e]),u.each(s.getFields(),function(e,t){var r=o+"_"+e,n=a[e]||{};u("#"+r).length<1||(u("#"+r).off("change",t.onChange),t.convert&&(Array.isArray(t.convert)&&-1===t.convert.indexOf(o)||("address_2"!==e||n.label||u('label[for="'+r+'"]').addClass("screen-reader-text"),u("#"+r).data("select2")&&u("#"+r).select2("destroy"),"calc_shipping"===o&&"address_2"===e&&u("#"+r+"_field").remove())))}))},100)))})}(jQuery,window.wc_checkout_params);